<GroupBox Name="GBDVitem" cols="xs12 sm12 md12 lg12"><Ctrls>
<ListCtrl Name="item_vLst" PageSize="20" ToolTip="ttp_item" Size="700,420" OnLoad="init" DataJoin="%{this}%{prop}" DataJoinKey="item_id_m" loadedclick="1">
			<MDX id="prop" datatype="string">
			<DbDetails>
				<DbTable>item_properties i left join item_property i0 on i.property_id=i0.property_id</DbTable> where 
				<Index>h_id </Index>
				<MDX>item_id_m,propname,propvalue</MDX>
				<Data>item_id_m,i0.prop_display_name propname,i.property_value propvalue</Data>
				<Order></Order>
				<Where>and item_status!=278</Where>
				<queryFormat>select %{data} from %{dbtable} where (org_id,item_id_m) IN (select * from(SELECT i.org_id,i.item_id_m from xbs.item i left join xbs.category c on i.item_category=c.category_id left join xbs.option_line o on i.item_type=o.option_line_id left join xbs.uom u on i.uom_id=u.uom_id left join xbs.option_line o0 on i.item_status=o0.option_line_id left join xbs.inv_item_revision i0 on i.item_rev_number=i0.inv_item_revision_id left join xbs.option_line o1 on i.locator_control=o1.option_line_id left join xbs.uom u0 on i.weight_uom_id=u0.uom_id left join xbs.uom u1 on i.volume_uom_id=u1.uom_id left join xbs.uom u2 on i.dimension_uom_id=u2.uom_id left join xbs.po_sourcing_rule_header p on i.sourcing_rule_id=p.po_sourcing_rule_header_id left join xbs.option_line o2 on i.receipt_routing=o2.option_line_id left join xbs.subinventory s on i.receipt_sub_inventory=s.subinventory_id left join xbs.option_line o3 on i.bom_type=o3.option_line_id left join xbs.option_line o4 on i.wip_supply_type=o4.option_line_id left join xbs.subinventory s0 on i.wip_supply_subinventory=s0.subinventory_id left join xbs.locator l on i.wip_supply_locator=l.locator_id left join xbs.option_line o5 on i.planning_method=o5.option_line_id left join xbs.option_line o6 on i.rounding_option=o6.option_line_id where i.org_id=%{orgid} %{where} limit %{StartRow},%{PgSize}) as orgitem)</queryFormat> 
			</DbDetails>
			</MDX>
	<DbDetails >
<DbTable>xbs.item i left join xbs.category c on i.item_category=c.category_id left join xbs.option_line o on i.item_type=o.option_line_id left join xbs.uom u on i.uom_id=u.uom_id left join xbs.option_line o0 on i.item_status=o0.option_line_id left join xbs.inv_item_revision i0 on i.item_rev_number=i0.inv_item_revision_id left join xbs.option_line o1 on i.locator_control=o1.option_line_id left join xbs.uom u0 on i.weight_uom_id=u0.uom_id left join xbs.uom u1 on i.volume_uom_id=u1.uom_id left join xbs.uom u2 on i.dimension_uom_id=u2.uom_id left join xbs.po_sourcing_rule_header p on i.sourcing_rule_id=p.po_sourcing_rule_header_id left join xbs.option_line o2 on i.receipt_routing=o2.option_line_id left join xbs.subinventory s on i.receipt_sub_inventory=s.subinventory_id left join xbs.option_line o3 on i.bom_type=o3.option_line_id left join xbs.option_line o4 on i.wip_supply_type=o4.option_line_id left join xbs.subinventory s0 on i.wip_supply_subinventory=s0.subinventory_id left join xbs.locator l on i.wip_supply_locator=l.locator_id left join xbs.option_line o5 on i.planning_method=o5.option_line_id left join xbs.option_line o6 on i.rounding_option=o6.option_line_id</DbTable>
<Index>item_id</Index>
<Data>i.item_number,i.item_name,i.item_specification,i.item_id_m,i.item_description,i.product_line,c.category item_category,i.image_file,o.option_line_value item_type,u.uom_name uom_id,i.product_line_percentage,o0.option_line_value item_status,i.pre_processing_lt,i.post_processing_lt,i.processing_lt,i.cumulative_mfg_lt,i.cumulative_total_lt,i.lt_lot_size,i.long_description,i.inventory_item_cb,i0.revision_name item_rev_number,o1.option_line_value locator_control,i.lot_uniqueness,i.lot_generation,i.lot_prefix,i.lot_starting_number,u0.uom_name weight_uom_id,i.weight,u1.uom_name volume_uom_id,i.volume,u2.uom_name dimension_uom_id,i.length,i.width,i.height,i.customer_ordered_cb,i.internal_ordered_cb,i.atp,i.shippable_cb,i.returnable_cb,i.picking_rule,i.purchased_cb,i.use_asl_cb,p.sourcing_rule sourcing_rule_id,i.default_buyer,o2.option_line_value receipt_routing,s.subinventory receipt_sub_inventory,i.over_receipt_percentage,i.over_receipt_action,i.receipt_days_early,i.receipt_days_late,i.receipt_day_action,i.make_buy,i.bom_enabled_cb,o3.option_line_value bom_type,i.build_in_wip_cb,o4.option_line_value wip_supply_type,s0.subinventory wip_supply_subinventory,l.locator wip_supply_locator,i.costing_enabled_cb,i.inventory_asset_cb,i.allow_negative_balance_cb,i.planner,o5.option_line_value planning_method,i.fix_order_quantity,i.fix_days_supply,i.minimum_order_quantity,i.maximum_order_quantity,i.demand_timefence,i.planning_timefence,i.release_timefence,o6.option_line_value rounding_option,i.saftey_stock_quantity,i.saftey_stock_days,i.saftey_stock_percentage,i.created_by,i.creation_date,i.last_update_by,i.last_update_date,i.item_id,i.org_id</Data>
<Order>item_id</Order>
<Where>and item_status!=278</Where>
<queryFormat id="tbpages">select %{data} from %{dbtable} where i.org_id='%{orgid}' %{where} limit %{StartRow},%{PgSize}</queryFormat></DbDetails>
<operator refresh="1" firstpage="1" prepage="1" nextpage="1">
<op text="modify"><info next="tst" expr="处理中......"/><DbDetails><Where>item_id='%{item_vLst[item_id]}'</Where></DbDetails><submit namelist="DbDetails" next="$this.item.itemLst"/></op>
<op text="revision"><assign name="$this.inv_item_revision_v.item_id_m" expr="%{item_vLst[item_id_m]}"/><DbDetails><Where>i.item_id_m='%{item_vLst[item_id_m]}' and i.org_id='%{orgid}'</Where></DbDetails><submit namelist="DbDetails" next="$this.inv_item_revision_v.inv_item_revision_VLst"/></op>
<op text="relation"><assign name="$this.inv_item_relation_v.item_id_m" expr="%{item_vLst[item_id_m]}"/><DbDetails><Where>i.to_item_id_m='%{item_vLst[item_id_m]}' and i.org_id='%{orgid}'</Where></DbDetails><submit namelist="DbDetails" next="$this.inv_item_relation_v.inv_item_relation_VLst"/></op>
<op text="property"><assign name="$this.item_properties_v.item_id_m" expr="%{item_vLst[item_id_m]}"/><assign name="$this.item_properties_v.org_id" expr="%{item_vLst[org_id]}"/><DbDetails><Where>item_id_m='%{item_id_m}' and org_id='%{org_id}'</Where></DbDetails>
	<submit namelist="DbDetails" next="$this.item_properties_v.item_properties_vLst"/></op>
<op text="BAT Modify" needconfirm="0"><assign name="$this.BatModify.NotComponentAsProduct" expr="1"/>
<!--DbDetails><queryFormat>UPDATE item SET item_type=99 WHERE item_id_m NOT IN (SELECT component_item_id_m FROM bom_line WHERE org_id='%{orgid}') AND org_id='%{orgid}';
UPDATE item SET purchased_cb=1,customer_ordered_cb=0,internal_ordered_cb=1 WHERE item_type=106 AND org_id='%{orgid}';
UPDATE item SET purchased_cb=0,customer_ordered_cb=0,internal_ordered_cb=1 WHERE item_type=105 AND org_id='%{orgid}';
UPDATE item SET purchased_cb=0,customer_ordered_cb=1,internal_ordered_cb=1 WHERE item_type=99 AND org_id='%{orgid}';
UPDATE bom_routing_header brh JOIN bom_routing_line brl ON brh.bom_routing_header_id=brl.bom_routing_header_id JOIN bom_routing_detail brd ON brl.bom_routing_line_id=brd.bom_routing_line_id JOIN bom_resource res ON brd.resource_id=res.bom_resource_id AND res.osp_cb JOIN item ON  item.item_id_m=brh.item_id_m AND item.org_id=brh.org_id SET purchased_cb=1;
UPDATE item SET receipt_routing=300 WHERE purchased_cb=1 and org_id='%{orgid}';</queryFormat></DbDetails><submit namelist="DbDetails"/><submit/--></op>
</operator>
<OnChanged>
<assign name="pgcur_item" expr="js(%{item_vLst[currentpage]}+1)"/>
<assign name="pgscb_item" expr="js(%{item_vLst[currentpage]}+1)" function="SetSel"/>
</OnChanged></ListCtrl>
</Ctrls></GroupBox>