<GroupBox Name="GBDVar_transaction_line" cols="xs12 sm12 md12 lg12"><Ctrls>
<ListCtrl Name="ar_transaction_line_vLst" ToolTip="ttp_ar_transaction_line" Size="700,180" DataJoin="%{this(reference_key_value,line_type,item_number,line_number,inv_line_quantity,inv_unit_price,inv_line_price,gl_inv_line_price,line_description,status)}%{detail}" DataJoinKey="ar_transaction_line_id" loadedclick="0">
			<MDX id="detail" datatype="string">
			<DbDetails>
				<DbTable>ar_transaction_detail atd JOIN option_line act ON atd.account_type=act.option_line_id</DbTable> where 
				<Index>ar_transaction_line_id </Index>
				<MDX>ar_transaction_line_id,acctp,amount</MDX>
				<Data>ar_transaction_line_id,option_line_value acctp,amount</Data>
			</DbDetails>
			</MDX>
	<DbDetails >
<DbTable>xbs.ar_transaction_line a left join xbs.option_line o on a.line_type=o.option_line_id left join xbs.item i on a.item_id_m=i.item_id_m left join xbs.option_line o0 on a.status=o0.option_line_id</DbTable>
<Index>ar_transaction_line_id</Index>
<Data>a.reference_key_value,o.option_line_value line_type,i.item_number,a.line_number,a.inv_line_quantity,a.inv_unit_price,a.inv_line_price,a.gl_inv_line_price,a.line_description,o0.option_line_value status,a.reference_type,a.reference_key_name,a.created_by,a.creation_date,a.last_update_by,a.last_update_date,a.ar_transaction_line_id</Data>
<Order>ar_transaction_line_id</Order></DbDetails>
<operator refresh="1" firstpage="1" prepage="1" nextpage="1">
<op text="addone" mustselected="0"><if cond="!%{ar_transaction_header_id}"><alert expr="请先添加或选择已有项目！"/><else/><assign name="$parent.ar_transaction_line.ar_transaction_line_id" expr=""/><assign name="$parent.ar_transaction_line.reference_key_name" expr="sd_so_line" function="setsel"/><DbDetails><Where>ar_transaction_header_id='%{ar_transaction_header_id}'</Where></DbDetails><submit next="$parent.ar_transaction_line.ar_transaction_header_id" namelist="DbDetails"/><DbDetails fcsm="1"><DbTable>sd_so_line sl join item i on sl.item_id_m=i.item_id_m and sl.shipping_org_id=i.org_id left join mdm_tax_code t on sl.tax_code_id=t.mdm_tax_code_id</DbTable><Index>sd_so_line_id</Index><Data>concat(line_number,' ',item_number) title,i.item_id_m,i.uom_id,unit_price inv_unit_price,i.item_description,(shipped_quantity-invoiced_quantity) inv_line_quantity,percentage,sd_so_line_id refid</Data><Where>sd_so_header_id='%{reference_key_value[refid]}'</Where></DbDetails><submit next="$parent.ar_transaction_line.reference_key_value" namelist="DbDetails"/></if></op>
<op text="modify"><assign name="$parent.ar_transaction_line.reference_key_name" expr="sd_so_line" function="setsel"/><DbDetails><Where>ar_transaction_header_id='%{ar_transaction_header_id}'</Where></DbDetails><submit next="$parent.ar_transaction_line.ar_transaction_header_id" namelist="DbDetails"/><DbDetails fcsm="1"><DbTable>sd_so_line sl join item i on sl.item_id_m=i.item_id_m and sl.shipping_org_id=i.org_id left join mdm_tax_code t on sl.tax_code_id=t.mdm_tax_code_id</DbTable><Index>sd_so_line_id</Index><Data>concat(line_number,' ',item_number) title,i.item_id_m,i.uom_id,unit_price inv_unit_price,percentage,sd_so_line_id refid</Data><Where>sd_so_header_id='%{reference_key_value[refid]}'</Where></DbDetails><submit next="$parent.ar_transaction_line.reference_key_value" namelist="DbDetails"/><DbDetails><Where>ar_transaction_line_id='%{ar_transaction_line_vLst[ar_transaction_line_id]}'</Where></DbDetails><submit namelist="DbDetails" next="$parent.ar_transaction_line.ar_transaction_lineLst"/></op>
<op text="delete" needconfirm="1"><DbDetails><DbTable>xbs.ar_transaction_line</DbTable><Where>ar_transaction_line_id='%{ar_transaction_line_vLst[ar_transaction_line_id]}'</Where><queryFormat>delete from %{table} where %{where} and status!=1527</queryFormat></DbDetails><submit namelist="DbDetails"/><submit/></op>
<op text="adddetail"><submit next="$parent.ar_transaction_detail.GBDEDITar_transaction_detail" function="reset"/><DbDetails><Where>ar_transaction_line_id='%{ar_transaction_line_vLst[ar_transaction_line_id]}'</Where></DbDetails><submit next="$parent.ar_transaction_detail.ar_transaction_line_id" namelist="DbDetails"/><DbDetails><Where></Where></DbDetails><submit namelist="DbDetails" next="$parent.ar_transaction_detail.detail_ac_id"/></op>
<op text="viewDetail"><assign name="$parent.ar_transaction_detail_v.ar_transaction_line_id" expr="%{ar_transaction_line_vLst[ar_transaction_line_id]}"/><DbDetails><Where>ar_transaction_line_id='%{ar_transaction_line_id}'</Where></DbDetails><submit next="$parent.ar_transaction_detail_v.ar_transaction_detail_vLst" namelist="DbDetails"/></op>
</operator>
</ListCtrl>
</Ctrls></GroupBox>