<GroupBox Name="GBDVinv_issue_line" cols="xs12 sm12 md12 lg12"><Ctrls>
<ListCtrl Name="inv_issue_line_vLst" ToolTip="ttp_inv_issue_line" Size="700,180" Heading="reference_key_value,120;item_number,120;item_name,120;transaction_quantity,75;uom_name,75;item_specification,120;item_description,120;subinventory_id,120;locator_id,120;lot_number,120;item_id_m,60;created_by,60;creation_date,150;last_update_by,60;last_update_date,150;inv_issue_line_id,60;status,125;" loadedclick="0">
	<DbDetails >
<DbTable>xbs.inv_issue_line i left join xbs.item i0 on i.item_id_m=i0.item_id_m left join xbs.subinventory s on i.subinventory_id=s.subinventory_id left join uom on i0.uom_id=uom.uom_id left join xbs.locator l on i.locator_id=l.locator_id left join xbs.inv_lot_number i1 on i.lot_number=i1.inv_lot_number_id left join xbs.currency c on i.currency=c.currency_id</DbTable>
<Index>inv_issue_line_id</Index>
<Data>i.reference_key_value,i0.item_number,item_name,i.transaction_quantity,uom_name,item_specification,i0.item_description,s.subinventory subinventory_id,l.locator locator_id,i1.lot_number lot_number, i0.item_id_m,i.created_by,i.creation_date,i.last_update_by,i.last_update_date,i.inv_issue_line_id,i.status</Data>
<Order>inv_issue_line_id</Order></DbDetails>
<operator refresh="1" firstpage="1" prepage="1" nextpage="1">
<op text="addone" mustselected="0"><if cond="!%{inv_issue_header_id}"><alert expr="请先添加或选择已有项目！"/><else/><assign name="$parent.inv_issue_line.transaction_type_id" expr="%{transaction_type_id[transaction_type_id]}"/><DbDetails><Where>inv_issue_header_id='%{inv_issue_header_id}' and status=1519</Where></DbDetails><submit next="$parent.inv_issue_line.inv_issue_header_id" namelist="DbDetails"/>
<if cond="%{transaction_type_id[transaction_type_id]}==6"><assign name="$parent.inv_issue_line.reference_key_name" expr="wip_wo_bom" function="setsel"/><DbDetails fcsm="1"><DbTable>xbs.wip_routing_bom_v</DbTable><Index>wip_wo_bom_id</Index><Data>concat(bom_sequence,' ',IFNULL(item_name,''),'/',IFNULL(item_specification,''),'/',component) title,item_id_m,transaction_quantity,unit_price,uom_id uom,wip_wo_bom_id refid</Data><Where>wip_wo_header_id='%{reference_key_value[refid]}' AND department_id='%{bom_department}'</Where></DbDetails><submit next="$parent.inv_issue_line.reference_key_value" namelist="DbDetails"/>
<elseif cond="%{transaction_type_id[transaction_type_id]}==14"/><assign name="$parent.inv_issue_line.reference_key_name" expr="sd_delivery_line" function="setsel"/><DbDetails fcsm="1"><DbTable>sd_dlv_line_v</DbTable><Index>sd_delivery_line_id</Index><Data>concat(line_number,' ',item_number) title,item_id_m,shipped_quantity transaction_quantity,unit_price,line_uom_id uom,sd_delivery_line_id refid</Data><Where>sd_delivery_header_id='%{reference_key_value[refid]}'</Where></DbDetails><submit next="$parent.inv_issue_line.reference_key_value" namelist="DbDetails"/>
</if></if>
</op>
<op text="modify"><assign name="$parent.inv_issue_line.transaction_type_id" expr="%{transaction_type_id[transaction_type_id]}"/><DbDetails><Where>inv_issue_header_id='%{inv_issue_header_id}'</Where></DbDetails><submit next="$parent.inv_issue_line.inv_issue_header_id" namelist="DbDetails"/>
<if cond="%{transaction_type_id[transaction_type_id]}==6"><assign name="$parent.inv_issue_line.reference_key_name" expr="wip_wo_bom" function="setsel"/><DbDetails fcsm="1"><DbTable>xbs.wip_routing_bom_v</DbTable><Index>wip_wo_bom_id</Index><Data>concat(bom_sequence,' ',IFNULL(item_name,''),'/',IFNULL(item_specification,''),'/',component) title,item_id_m,transaction_quantity,unit_price,uom_id uom,wip_wo_bom_id refid</Data><Where>wip_wo_header_id='%{reference_key_value[refid]}' AND department_id='%{bom_department}'</Where></DbDetails><submit next="$parent.inv_issue_line.reference_key_value" namelist="DbDetails"/>
<elseif cond="%{transaction_type_id[transaction_type_id]}==14"/><assign name="$parent.inv_issue_line.reference_key_name" expr="sd_delivery_line" function="setsel"/><DbDetails fcsm="1"><DbTable>sd_dlv_line_v</DbTable><Index>sd_delivery_line_id</Index><Data>concat(line_number,' ',item_number) title,item_id_m,shipped_quantity transaction_quantity,unit_price,line_uom_id uom,sd_delivery_line_id refid</Data><Where>sd_delivery_header_id='%{reference_key_value[refid]}'</Where></DbDetails><submit next="$parent.inv_issue_line.reference_key_value" namelist="DbDetails"/>
</if><DbDetails><Where>inv_issue_line_id='%{inv_issue_line_vLst[inv_issue_line_id]}' and status=1519</Where></DbDetails><submit namelist="DbDetails" next="$parent.inv_issue_line.inv_issue_lineLst"/>
</op>
<op text="delete"><assign name="topmost" expr="sql:delete il from inv_issue_line il join inv_issue_header ih on il.inv_issue_header_id=ih.inv_issue_header_id where inv_issue_line_id=%{inv_issue_line_vLst[inv_issue_line_id]} and ih.status=1519"/><submit/></op>
</operator>
</ListCtrl>
</Ctrls></GroupBox>